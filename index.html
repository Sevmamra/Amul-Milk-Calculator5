<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Amul Milk Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

</head>
<body class="dark-mode">

    <header class="header">
        <img src="header-title.png" alt="Amul Title" class="title-img">
    </header>

    <div class="container pb-40">
        <div class="controls">
            <div class="search-container">
                <input type="search" id="search-input" class="search-input" placeholder="Search product...">
                <button id="search-clear-btn" class="search-clear-btn hidden">&times;</button>
            </div>
            <div class="control-buttons">
                <div style="text-align: center;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-calculate" checked>
                        <span class="slider"></span>
                    </label>
                    <div class="auto-calc-label">Auto</div>
                </div>
                <button id="settings-btn" class="btn-icon" title="Settings"><i class="fas fa-cog"></i></button>
                <button id="load-last-order-btn" class="btn-icon" title="Load Last Order"><i class="fas fa-history"></i></button>
                <button id="history-btn" class="btn-icon" title="History"><i class="fas fa-chart-bar"></i></button>
            </div>
        </div>

        <div id="product-list"></div>
    </div>

    <footer class="footer">
        <div class="total-container">
            <div id="crate-count-container">
                <span class="total-label">Crates:</span>
                <span id="total-crates" class="total-amount" style="color: var(--amul-blue);">0</span>
            </div>
            <div>
                <span class="total-label">Total Amount:</span>
                <span id="total-amount" class="total-amount">â‚¹ 0.00</span>
            </div>
        </div>
        <div class="action-buttons">
            <button id="reset-btn" class="btn-side" title="Reset"><i class="fas fa-redo"></i></button>
            <button id="calculate-btn" class="btn-main hidden"><i class="fas fa-calculator"></i> Calculate</button>
            <button id="save-btn" class="btn-side" title="Save"><i class="fas fa-save"></i></button>
        </div>
    </footer>

    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">History & Analytics</h2>
                <button id="close-history" class="btn-icon">&times;</button>
            </div>
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="history-tab">History</button>
                <button class="tab-btn" data-tab="analytics-tab">Analytics</button>
            </div>
            <div id="history-tab" class="tab-content active">
                <div class="history-filters">
                    <input type="date" id="start-date-filter" title="Start Date">
                    <input type="date" id="end-date-filter" title="End Date">
                    <button id="apply-filter-btn" class="btn-filter">Filter</button>
                </div>
                <div class="history-actions">
                    <button id="select-all-history-btn">Select All</button>
                    <button id="delete-selected-history-btn">Delete Selected</button>
                </div>
                <div id="history-list" class="modal-body"></div>
                <div class="download-section">
                    <h4>Download Filtered Data</h4>
                    <div class="download-options">
                        <label><input type="radio" name="download-format" value="image" checked> Image</label>
                        <label><input type="radio" name="download-format" value="pdf"> PDF</label>
                        <label><input type="radio" name="download-format" value="csv"> CSV</label>
                    </div>
                    <button id="download-btn" class="btn-main">Download</button>
                </div>
            </div>
            <div id="analytics-tab" class="tab-content">
                 <div class="history-filters">
                    <input type="month" id="analytics-month-filter">
                    <button id="run-analytics-btn" class="btn-filter">Generate</button>
                </div>
                <div id="analytics-content" class="modal-body">
                    <p class="text-center">Select a month and click 'Generate' to view analytics.</p>
                </div>
                 <button id="download-analytics-pdf-btn" class="btn-main hidden">Download PDF</button>
            </div>
        </div>
    </div>
    
    <div id="order-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Order Details</h2>
                <button id="close-order-details" class="btn-icon">&times;</button>
            </div>
            <div id="order-details-list" class="modal-body"></div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button id="close-settings" class="btn-icon">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-section">
                    <h3>Theme</h3>
                    <button id="theme-toggle-btn" class="btn-main"><i class="fas fa-sun"></i> Toggle Theme</button>
                </div>
                <div class="setting-section">
                    <h3>Data Management</h3>
                    <div class="data-actions">
                        <button id="export-data-btn" class="btn-main"><i class="fas fa-file-export"></i> Export Data</button>
                        <label for="import-file-input" class="btn-main import-label">
                            <i class="fas fa-file-import"></i> Import Data
                            <input type="file" id="import-file-input" accept=".json" class="hidden">
                        </label>
                    </div>
                </div>
                <div class="setting-section">
                    <h3>Manage Products</h3>
                    <div id="manage-product-list"></div>
                    <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Add New Product</h4>
                    <form id="add-product-form">
                        <input type="text" id="product-name" placeholder="Product Name" required>
                        <input type="text" id="product-size" placeholder="Size (e.g., 500ml)" required>
                        <input type="number" id="product-price" placeholder="Price" step="0.01" required>
                        <input type="text" id="product-category" placeholder="Category" required>
                        <div class="container-type-selector">
                            <span>Container:</span>
                            <label><input type="radio" name="container-type" value="crate" checked> Crate</label>
                            <label><input type="radio" name="container-type" value="box"> Box</label>
                            <label><input type="radio" name="container-type" value="packet"> Packet</label>
                        </div>
                        <button type="submit" class="btn-main">Add New Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div id="edit-product-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Product</h2>
                <button id="close-edit-product" class="btn-icon">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-product-form">
                    <input type="hidden" id="edit-product-id">
                    <label>Name:</label>
                    <input type="text" id="edit-product-name" required>
                    <label>Size:</label>
                    <input type="text" id="edit-product-size" required>
                    <label>Price:</label>
                    <input type="number" id="edit-product-price" step="0.01" required>
                    <label>Category:</label>
                    <input type="text" id="edit-product-category" required>
                     <div class="container-type-selector" id="edit-container-type-selector">
                        <span>Container:</span>
                        <label><input type="radio" name="edit-container-type" value="crate"> Crate</label>
                        <label><input type="radio" name="edit-container-type" value="box"> Box</label>
                        <label><input type="radio" name="edit-container-type" value="packet"> Packet</label>
                    </div>
                    <button type="submit" class="btn-main">Save Changes</button>
                </form>
            </div>
        </div>
    </div>


    <div id="toast" class="toast">Action complete!</div>

    <script src="script.js"></script>
</body>
</html>
